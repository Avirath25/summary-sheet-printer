<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>4 Credit Course CIE Calculator</title>
  <style>
    body { font-family: Arial, sans-serif; background: #eef3fa; padding: 20px; }
    .container { max-width: 700px; margin: auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 0 6px rgba(0,0,0,0.2);}
    h2 { text-align: center; color: #004080; }
    label { display: block; margin-top: 10px; }
    input { width: 100%; padding: 8px; margin-top: 4px; border: 1px solid #ccc; border-radius: 4px; }
    button { margin-top: 20px; padding: 10px; width: 100%; background: #004080; color: white; border: none; border-radius: 5px; cursor: pointer;}
    button:hover { background: #002b55; }
  </style>
</head>
<body>
<div class="container">
  <h2>4 Credit CIE Calculator</h2>
  
  <label>Student Name: <input type="text" id="studentName"></label>
  <label>USN: <input type="text" id="usn"></label>
  <label>Semester: <input type="text" id="semester"></label>
  <label>Section: <input type="text" id="section"></label>
  <label>Subject: <input type="text" id="subject"></label>
  <label>Subject Code: <input type="text" id="subCode"></label>
  <label>Faculty Name: <input type="text" id="facultyName"></label>

  <label>Test 1 (40): <input type="number" id="test1" max="40"></label>
  <label>Test 2 (40): <input type="number" id="test2" max="40"></label>
  <label>Makeup Test (40): <input type="number" id="makeup" max="40"></label>
  <label>Assignment 1 (25): <input type="number" id="asg1" max="25"></label>
  <label>Assignment 2 (25): <input type="number" id="asg2" max="25"></label>
  <label>CIE Practical (15): <input type="number" id="cie" max="15"></label>
  <label>Lab Test (10): <input type="number" id="lab" max="10"></label>

  <button onclick="calculate()">Calculate & Generate Sheet</button>
</div>

<script>
function calculate() {
    const t1 = parseFloat(document.getElementById("test1").value) || 0;
    const t2 = parseFloat(document.getElementById("test2").value) || 0;
    const mu = parseFloat(document.getElementById("makeup").value) || 0;
    const a1 = parseFloat(document.getElementById("asg1").value) || 0;
    const a2 = parseFloat(document.getElementById("asg2").value) || 0;
    const labCie = parseFloat(document.getElementById("cie").value) || 0;
    const labTest = parseFloat(document.getElementById("lab").value) || 0;

    // Best two internals → scaled to 15
    const internals = [t1, t2, mu].filter(v => !isNaN(v));
    let avg40 = 0;
    let internal15 = 0;
    if (internals.length === 1) {
        avg40 = internals[0];
        internal15 = (avg40 / 40) * 15;
    } else if (internals.length >= 2) {
        const best2 = internals.sort((a,b)=>b-a).slice(0,2);
        avg40 = (best2[0] + best2[1]) / 2;
        internal15 = (avg40 / 40) * 15;
    }
    internal15 = parseFloat(internal15.toFixed(1));

    // Assignments avg → scaled to 10
    let assign10 = 0;
    if (!isNaN(a1) && !isNaN(a2)) assign10 = ((a1 + a2)/50)*10;
    else if (!isNaN(a1)) assign10 = (a1/25)*10;
    else if (!isNaN(a2)) assign10 = (a2/25)*10;
    assign10 = parseFloat(assign10.toFixed(1));

    // Total Theory + Assignment
    const totalTA = parseFloat((internal15 + assign10).toFixed(1));

    // Practical total
    const practicalTotal = parseFloat((labCie + labTest).toFixed(1));

    // Final CIE
    let finalCIE = parseFloat((totalTA + practicalTotal).toFixed(1));
    if(finalCIE > 50) finalCIE = 50; // cap at 50

    // Grade
    let grade = "";
    if (finalCIE >= 45) grade = "O - Outstanding";
    else if (finalCIE >= 40) grade = "A+ - Excellent";
    else if (finalCIE >= 35) grade = "A - Very Good";
    else if (finalCIE >= 30) grade = "B+ - Good";
    else if (finalCIE >= 25) grade = "B - Above Average";
    else if (finalCIE >= 20) grade = "C - Average";
    else if (finalCIE >= 15) grade = "P - Pass";
    else grade = "F - Fail";

    // Store in localStorage in same pattern as before
    const cieData = {
        studentName: document.getElementById("studentName").value,
        usn: document.getElementById("usn").value,
        semester: document.getElementById("semester").value,
        section: document.getElementById("section").value,
        subject: document.getElementById("subject").value,
        subCode: document.getElementById("subCode").value,
        facultyName: document.getElementById("facultyName").value,

        test1_4credit: t1,
        test2_4credit: t2,
        makeup_4credit: mu,
        best_two_cie_4credit: internal15,
        asg1_4credit: a1,
        asg2_4credit: a2,
        avg_asg_4credit: assign10,
        total_cie_ta_4credit: totalTA,
        cie_4credit: labCie,
        lab_test_4credit: labTest,
        total_practical_4credit: practicalTotal,
        final_cie_4credit: finalCIE,

        total_cie_secured: finalCIE,
        marks_in_words: numberToWords(finalCIE),
        grade: grade
    };

    localStorage.setItem("cieData", JSON.stringify(cieData));

    // Redirect to sheet2.html
    window.location.href = "sheet2.html";

    // Convert number to words
    function numberToWords(num) {
        const ones = ["Zero","One","Two","Three","Four","Five","Six","Seven","Eight","Nine","Ten",
                      "Eleven","Twelve","Thirteen","Fourteen","Fifteen","Sixteen","Seventeen","Eighteen","Nineteen"];
        const tens = ["","","Twenty","Thirty","Forty","Fifty"];
        if(num < 20) return ones[num];
        if(num < 60) return tens[Math.floor(num/10)] + (num%10 ? " " + ones[num%10] : "");
        return num;
    }
}
</script>
</body>
</html>
